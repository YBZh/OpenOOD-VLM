############################################################ 
tau=1.0
beta=1.0
######################### clip +  MCM.
prompt=simple
for in_score in sum
do
    for beta in 1
    do
        python main.py \
        --config configs/datasets/imagenet/imagenet_traditional_four_ood.yml \
        configs/networks/fixed_clip.yml \
        configs/pipelines/test/test_fsood.yml \
        configs/preprocessors/base_preprocessor.yml \
        configs/postprocessors/mcm.yml \
        --dataset.train.batch_size 128 \
        --dataset.train.few_shot 2 \
        --dataset.num_classes 1000 \
        --evaluator.name ood_clip \
        --network.name fixedclip \
        --network.backbone.text_prompt ${prompt} \
        --network.backbone.text_center True \
        --network.pretrained False \
        --postprocessor.APS_mode True \
        --postprocessor.name mcm \
        --postprocessor.postprocessor_args.tau ${tau}  \
        --postprocessor.postprocessor_args.beta ${beta}  \
        --postprocessor.postprocessor_args.in_score ${in_score}  \
        --num_gpus 1 --num_workers 6 \
        --merge_option merge \
        --output_dir ./mcm_official/ \
        --mark ${in_score}_beta${beta}
    done
done


# Starting automatic parameter search...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:17<00:00,  1.17it/s]
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:24<00:00,  1.06s/it]
# Hyperparam:[0.5], auroc:0.7036518795713557
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:17<00:00,  1.18it/s]
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:23<00:00,  1.03s/it]
# Hyperparam:[1], auroc:0.7448792651811532
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:17<00:00,  1.15it/s]
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:23<00:00,  1.04s/it]
# Hyperparam:[1.5], auroc:0.7629525939785679
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:17<00:00,  1.13it/s]
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:23<00:00,  1.04s/it]
# Hyperparam:[2.0], auroc:0.7648436808981119
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:17<00:00,  1.12it/s]
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:23<00:00,  1.02s/it]
# Hyperparam:[3.0], auroc:0.760053342405171
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [00:17<00:00,  1.14it/s]
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:22<00:00,  1.01it/s]
# Hyperparam:[5.0], auroc:0.753084300051029
# Final hyperparam: 2.0
# Performing inference on imagenet dataset...
# 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 196/196 [02:05<00:00,  1.56it/s]
# ──────────────────────────────────────────────────────────────────────
# Processing nearood...
# Performing inference on ssb_hard dataset...
# 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 192/192 [01:19<00:00,  2.41it/s]
# Computing metrics on ssb_hard dataset...
# FPR@95: 84.70, AUROC: 66.10 AUPR_IN: 65.95, AUPR_OUT: 63.35
# ACC: 66.40
# ──────────────────────────────────────────────────────────────────────
# Performing inference on ninco dataset...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:25<00:00,  1.09s/it]
# Computing metrics on ninco dataset...
# FPR@95: 67.55, AUROC: 76.23 AUPR_IN: 96.36, AUPR_OUT: 27.55
# ACC: 66.40
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 76.12, AUROC: 71.16 AUPR_IN: 81.15, AUPR_OUT: 45.45
# ACC: 66.40
# ──────────────────────────────────────────────────────────────────────
# ──────────────────────────────────────────────────────────────────────
# Processing farood...
# Performing inference on inaturalist dataset...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 40/40 [00:48<00:00,  1.21s/it]
# Computing metrics on inaturalist dataset...
# FPR@95: 28.69, AUROC: 92.98 AUPR_IN: 98.43, AUPR_OUT: 72.22
# ACC: 66.40
# ──────────────────────────────────────────────────────────────────────
# Performing inference on sun dataset...
# 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [04:51<00:00,  1.86s/it]
# Computing metrics on sun dataset...
# FPR@95: 37.36, AUROC: 90.64 AUPR_IN: 91.89, AUPR_OUT: 87.51
# ACC: 66.40
# ──────────────────────────────────────────────────────────────────────
# Performing inference on places dataset...
# 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 157/157 [02:06<00:00,  1.24it/s]
# Computing metrics on places dataset...
# FPR@95: 53.75, AUROC: 87.30 AUPR_IN: 88.78, AUPR_OUT: 83.96
# ACC: 66.40
# ──────────────────────────────────────────────────────────────────────
# Performing inference on dtd dataset...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:17<00:00,  1.28it/s]
# Computing metrics on dtd dataset...
# FPR@95: 58.71, AUROC: 85.19 AUPR_IN: 97.77, AUPR_OUT: 44.38
# ACC: 66.40
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 44.63, AUROC: 89.03 AUPR_IN: 94.21, AUPR_OUT: 72.02
# ACC: 66.40


# ############################################################ 
# tau=1.0
# beta=1.0
# ######################### clip +  MCM.
# prompt=simple
# for in_score in sum
# do
#     for beta in 1
#     do
#         python main.py \
#         --config configs/datasets/imagenet/imagenet_train_ood.yml \
#         configs/networks/fixed_clip.yml \
#         configs/pipelines/test/test_fsood.yml \
#         configs/preprocessors/base_preprocessor.yml \
#         configs/postprocessors/mcm.yml \
#         --dataset.train.batch_size 128 \
#         --dataset.train.few_shot 2 \
#         --dataset.num_classes 1000 \
#         --evaluator.name ood_clip \
#         --network.name fixedclip \
#         --network.backbone.text_prompt ${prompt} \
#         --network.backbone.text_center True \
#         --network.pretrained False \
#         --postprocessor.APS_mode False \
#         --postprocessor.name mcm \
#         --postprocessor.postprocessor_args.tau ${tau}  \
#         --postprocessor.postprocessor_args.beta ${beta}  \
#         --postprocessor.postprocessor_args.in_score ${in_score}  \
#         --num_gpus 1 --num_workers 6 \
#         --merge_option merge \
#         --output_dir ./mcm_official/ \
#         --mark ${in_score}_beta${beta}
#     done
# done


# Start evaluation...
# Eval: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 176/176 [01:56<00:00,  1.51it/s]

# Accuracy 66.31%
# ──────────────────────────────────────────────────────────────────────
# Performing inference on imagenet dataset...
# 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 176/176 [01:59<00:00,  1.47it/s]
# ──────────────────────────────────────────────────────────────────────
# Processing nearood...
# Performing inference on ssb_hard dataset...
# 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 192/192 [01:16<00:00,  2.52it/s]
# Computing metrics on ssb_hard dataset...
# FPR@95: 86.29, AUROC: 63.01 AUPR_IN: 60.87, AUPR_OUT: 63.40
# ACC: 66.31
# ──────────────────────────────────────────────────────────────────────
# Performing inference on ninco dataset...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 23/23 [00:25<00:00,  1.09s/it]
# Computing metrics on ninco dataset...
# FPR@95: 71.64, AUROC: 74.06 AUPR_IN: 95.45, AUPR_OUT: 27.23
# ACC: 66.31
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 78.96, AUROC: 68.54 AUPR_IN: 78.16, AUPR_OUT: 45.31
# ACC: 66.31
# ──────────────────────────────────────────────────────────────────────
# ──────────────────────────────────────────────────────────────────────
# Processing farood...
# Performing inference on inaturalist dataset...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 40/40 [00:48<00:00,  1.22s/it]
# Computing metrics on inaturalist dataset...
# FPR@95: 56.07, AUROC: 86.40 AUPR_IN: 96.24, AUPR_OUT: 62.51
# ACC: 66.31
# ──────────────────────────────────────────────────────────────────────
# Performing inference on textures dataset...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 21/21 [00:18<00:00,  1.15it/s]
# Computing metrics on textures dataset...
# FPR@95: 67.50, AUROC: 81.82 AUPR_IN: 97.03, AUPR_OUT: 40.82
# ACC: 66.31
# ──────────────────────────────────────────────────────────────────────
# Performing inference on openimageo dataset...
# 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 62/62 [00:40<00:00,  1.52it/s]
# Computing metrics on openimageo dataset...
# FPR@95: 56.91, AUROC: 86.06 AUPR_IN: 94.04, AUPR_OUT: 71.04
# ACC: 66.31
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 60.16, AUROC: 84.76 AUPR_IN: 95.77, AUPR_OUT: 58.12
# ACC: 66.31
# ──────────────────────────────────────────────────────────────────────




# ############################################################ 
# tau=1.0
# beta=1.0
# ######################### clip + MCM, Cifar
# prompt=simple
# for in_score in sum
# do
#     for beta in 1
#     do
#         python main.py \
#         --config configs/datasets/cifar100/cifar100_clip.yml \
#         configs/networks/fixed_clip.yml \
#         configs/pipelines/test/test_fsood.yml \
#         configs/preprocessors/base_preprocessor.yml \
#         configs/postprocessors/mcm.yml \
#         --dataset.train.batch_size 128 \
#         --dataset.train.few_shot 2 \
#         --dataset.num_classes 1000 \
#         --evaluator.name ood_clip \
#         --network.name fixedclip \
#         --network.backbone.text_prompt ${prompt} \
#         --network.backbone.text_center True \
#         --network.pretrained False \
#         --postprocessor.APS_mode False \
#         --postprocessor.name mcm \
#         --postprocessor.postprocessor_args.tau ${tau}  \
#         --postprocessor.postprocessor_args.beta ${beta}  \
#         --postprocessor.postprocessor_args.in_score ${in_score}  \
#         --num_gpus 1 --num_workers 6 \
#         --merge_option merge \
#         --output_dir ./mcm_official/ \
#         --mark ${in_score}_beta${beta}_cifar100
#     done
# done
# ──────────────────────────────────────────────────────────────────────
# Performing inference on cifar100 dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:16<00:00,  3.04it/s]
# ──────────────────────────────────────────────────────────────────────
# Processing nearood...
# Performing inference on cifar10 dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:16<00:00,  4.83it/s]
# Computing metrics on cifar10 dataset...
# FPR@95: 73.28, AUROC: 73.66 AUPR_IN: 74.63, AUPR_OUT: 67.87
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────
# Performing inference on tin dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 51/51 [00:12<00:00,  4.22it/s]
# Computing metrics on tin dataset...
# FPR@95: 77.11, AUROC: 68.34 AUPR_IN: 77.62, AUPR_OUT: 50.98
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 75.20, AUROC: 71.00 AUPR_IN: 76.12, AUPR_OUT: 59.42
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────
# ──────────────────────────────────────────────────────────────────────
# Processing farood...
# Performing inference on mnist dataset...
# 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 547/547 [01:45<00:00,  5.17it/s]
# Computing metrics on mnist dataset...
# FPR@95: 28.11, AUROC: 88.67 AUPR_IN: 76.29, AUPR_OUT: 96.71
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────
# Performing inference on svhn dataset...
# 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 204/204 [00:41<00:00,  4.91it/s]
# Computing metrics on svhn dataset...
# FPR@95: 37.13, AUROC: 85.22 AUPR_IN: 80.38, AUPR_OUT: 90.04
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────
# Performing inference on texture dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 45/45 [00:18<00:00,  2.43it/s]
# Computing metrics on texture dataset...
# FPR@95: 82.81, AUROC: 70.84 AUPR_IN: 80.02, AUPR_OUT: 49.94
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────
# Performing inference on places365 dataset...
# 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 264/264 [00:55<00:00,  4.75it/s]
# Computing metrics on places365 dataset...
# FPR@95: 89.21, AUROC: 59.30 AUPR_IN: 30.82, AUPR_OUT: 79.01
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 59.32, AUROC: 76.00 AUPR_IN: 66.88, AUPR_OUT: 78.93
# ACC: 66.64
# ──────────────────────────────────────────────────────────────────────



# ############################################################ 
# tau=1.0
# beta=1.0
# ######################### clip + MCM, Cifar
# prompt=simple
# for in_score in sum
# do
#     for beta in 1
#     do
#         python main.py \
#         --config configs/datasets/cifar10/cifar10_clip.yml \
#         configs/networks/fixed_clip.yml \
#         configs/pipelines/test/test_fsood.yml \
#         configs/preprocessors/base_preprocessor.yml \
#         configs/postprocessors/mcm.yml \
#         --dataset.train.batch_size 128 \
#         --dataset.train.few_shot 2 \
#         --dataset.num_classes 1000 \
#         --evaluator.name ood_clip \
#         --network.name fixedclip \
#         --network.backbone.text_prompt ${prompt} \
#         --network.backbone.text_center True \
#         --network.pretrained False \
#         --postprocessor.APS_mode False \
#         --postprocessor.name mcm \
#         --postprocessor.postprocessor_args.tau ${tau}  \
#         --postprocessor.postprocessor_args.beta ${beta}  \
#         --postprocessor.postprocessor_args.in_score ${in_score}  \
#         --num_gpus 1 --num_workers 6 \
#         --merge_option merge \
#         --output_dir ./mcm_official/ \
#         --mark ${in_score}_beta${beta}_cifar10
#     done
# done

# Accuracy 90.09%
# ──────────────────────────────────────────────────────────────────────
# Performing inference on cifar10 dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 50/50 [00:17<00:00,  2.94it/s]
# ──────────────────────────────────────────────────────────────────────
# Processing nearood...
# Performing inference on cifar100 dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 71/71 [00:15<00:00,  4.55it/s]
# Computing metrics on cifar100 dataset...
# FPR@95: 29.23, AUROC: 92.28 AUPR_IN: 93.56, AUPR_OUT: 90.11
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────
# Performing inference on tin dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 61/61 [00:13<00:00,  4.46it/s]
# Computing metrics on tin dataset...
# FPR@95: 32.50, AUROC: 91.56 AUPR_IN: 92.69, AUPR_OUT: 87.68
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 30.86, AUROC: 91.92 AUPR_IN: 93.13, AUPR_OUT: 88.90
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────
# ──────────────────────────────────────────────────────────────────────
# Processing farood...
# Performing inference on mnist dataset...
# 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 547/547 [01:48<00:00,  5.04it/s]
# Computing metrics on mnist dataset...
# FPR@95: 3.29, AUROC: 99.07 AUPR_IN: 96.95, AUPR_OUT: 99.82
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────
# Performing inference on svhn dataset...
# 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 204/204 [00:41<00:00,  4.88it/s]
# Computing metrics on svhn dataset...
# FPR@95: 5.61, AUROC: 98.55 AUPR_IN: 97.42, AUPR_OUT: 99.31
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────
# Performing inference on texture dataset...
# 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 45/45 [00:16<00:00,  2.79it/s]
# Computing metrics on texture dataset...
# FPR@95: 20.59, AUROC: 94.74 AUPR_IN: 97.04, AUPR_OUT: 88.86
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────
# Performing inference on place365 dataset...
# 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 275/275 [01:00<00:00,  4.54it/s]
# Computing metrics on place365 dataset...
# FPR@95: 42.47, AUROC: 89.81 AUPR_IN: 68.48, AUPR_OUT: 96.16
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────
# Computing mean metrics...
# FPR@95: 17.99, AUROC: 95.54 AUPR_IN: 89.97, AUPR_OUT: 96.04
# ACC: 90.09
# ──────────────────────────────────────────────────────────────────────